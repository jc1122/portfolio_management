# Asset Classification Script: `classify_assets.py`

## Overview

This script is the third step in the portfolio management toolkit's data pipeline. It acts as an orchestrator that takes the clean, filtered list of assets from the asset selection step and enriches it with categorical information.

Its primary purpose is to assign an `asset_class` (e.g., Equity, Bond, Commodity) and `geography` (e.g., North America, Europe) to each asset. This classification is essential for applying category-based constraints in the later portfolio construction phase.

## Inputs (Prerequisites)

Before running the script, you must have the following:

1. **Python Environment**: Python 3.10+ with the `pandas` library installed.
1. **Selected Assets CSV (Required)**: The primary input is the CSV file generated by the `select_assets.py` script, specified via the `--input` argument.
1. **Overrides CSV (Optional)**: You can provide a CSV file to manually override the classification for specific assets. This file should contain columns for an identifier (`symbol` or `isin`) and any fields you wish to override (e.g., `asset_class`, `geography`).

## Script Products

1. **Classified Assets CSV (Primary Product)**

   - **Location**: The path specified by the `--output` argument (e.g., `/tmp/classified_assets.csv`).
   - **Description**: This is the main product. It is a CSV file containing all the data from the input file, plus new columns for the classification results: `asset_class`, `sub_class`, `geography`, and `confidence`. This file is the direct input for the next step, `calculate_returns.py`.

1. **Classification Review File (Optional Product)**

   - **Location**: The path specified by the `--export-for-review` argument.
   - **Description**: A CSV file generated with all the script's classifications, formatted to be easily edited and used as an `overrides` file for subsequent runs.

1. **Console Summary**

   - When run with the `--summary` flag, the script prints a report to the console, showing breakdowns by asset class and geography, and highlighting any assets with low classification confidence.

## Features

- **Rule-Based Classification**: The script uses an internal, rule-based engine to automatically assign an asset class and geography based on the asset's metadata (name, category, currency, etc.).

  > **TODO:** The detailed logic for the rule-based classification (e.g., keywords, confidence scoring) will be described later, when we make a documentation for the core functionality (`AssetClassifier` module).

- **Manual Overrides**: Provides a mechanism to manually set the classification for any asset via a simple CSV file, giving the user full control and a way to correct any automated errors.

- **Confidence Scoring**: Each automated classification is assigned a `confidence` score, making it easy to identify which assets may require manual review.

- **Review and Summary Tools**: The script includes helper features to summarize the classification results (`--summary`) and to export a template that simplifies the process of reviewing and creating overrides (`--export-for-review`).

## Usage Example

```bash
python scripts/classify_assets.py \
    --input /tmp/selected_assets.csv \
    --output /tmp/classified_assets.csv \
    --summary
```

To use a manual override file:

```bash
python scripts/classify_assets.py \
    --input /tmp/selected_assets.csv \
    --output /tmp/classified_assets.csv \
    --overrides /path/to/my_overrides.csv
```

## Command-Line Arguments

- `--input`: **(Required)** Path to the selected assets CSV file.
- `--output`: Path to save the classified assets CSV. If omitted, prints to the console.
- `--overrides`: Path to a CSV file with manual classification overrides.
- `--export-for-review`: Path to export a CSV template for manual review.
- `--summary`: If specified, prints a summary of the classification results to the console.
- `--verbose`: Enable detailed logging output.
